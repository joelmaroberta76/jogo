<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Neon Hacker: Subway Escape</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #050010;
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    color: #0ff;
    position: relative;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: linear-gradient(to bottom, #030011 0%, #0a0033 100%);
    box-shadow: 0 0 40px #0ff inset;
    border: 2px solid #0ff;
  }

  #hud {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 18px;
    text-shadow: 0 0 10px #00ffff;
    z-index: 10;
  }

  #retryBtn {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #0ff;
    color: #030011;
    font-family: 'Orbitron', sans-serif;
    font-size: 24px;
    border: none;
    padding: 15px 30px;
    cursor: pointer;
    border-radius: 10px;
    box-shadow: 0 0 20px #0ff;
    display: none;
    z-index: 20;
  }
  #retryBtn:hover {
    background: #00ddff;
  }
</style>
</head>
<body>

<div id="hud">
  ðŸ’¾ Chips: <span id="score">0</span> | âš¡ Power: <span id="power">Nenhum</span>
</div>
<button id="retryBtn">Tente Novamente</button>
<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const powerEl = document.getElementById("power");
const retryBtn = document.getElementById("retryBtn");

let score, frame, speed, gameOver;
let player, obstacles, lasers, chips, currentLane;
const lanes = [200, 280, 360];

const playerSprite = new Image();
playerSprite.src = "https://i.ibb.co/tDJjC4N/robot-run.png"; // robÃ´ futurista

function init() {
  score = 0;
  frame = 0;
  speed = 7;
  gameOver = false;

  player = {
    x: 120,
    y: 280,
    w: 50,
    h: 70,
    color: "#00ffff",
    invisible: false,
    quantum: false,
    sprite: playerSprite
  };

  obstacles = [];
  lasers = [];
  chips = [];
  currentLane = 1;

  scoreEl.textContent = score;
  powerEl.textContent = "Nenhum";
  retryBtn.style.display = "none";
}

function activateInvisibility() {
  if (player.invisible) return;
  player.invisible = true;
  player.color = "#0077ff";
  powerEl.textContent = "InvisÃ­vel";
  setTimeout(() => {
    player.invisible = false;
    player.color = "#00ffff";
    powerEl.textContent = "Nenhum";
  }, 3000);
}

function activateQuantum() {
  if (player.quantum) return;
  player.quantum = true;
  player.color = "#ff00ff";
  powerEl.textContent = "Salto QuÃ¢ntico";
  setTimeout(() => {
    player.quantum = false;
    player.color = "#00ffff";
    powerEl.textContent = "Nenhum";
  }, 1500);
}

document.addEventListener("keydown", (e) => {
  if (gameOver) return; // nÃ£o mexer se terminou
  if (e.code === "ArrowUp" && currentLane > 0) currentLane--;
  if (e.code === "ArrowDown" && currentLane < lanes.length - 1) currentLane++;
  if (e.code === "Space") activateInvisibility();
  if (e.code === "ShiftLeft" || e.code === "ShiftRight") activateQuantum();
});

function spawnObstacle() {
  const type = Math.random() < 0.5 ? "drone" : "barreira";
  obstacles.push({
    x: canvas.width,
    y: lanes[Math.floor(Math.random() * 3)],
    w: 50,
    h: 40,
    type,
    color: type === "drone" ? "#ff0055" : "#ff8800"
  });
}

function spawnLaser() {
  lasers.push({
    x: canvas.width,
    y: lanes[Math.floor(Math.random() * 3)] + 15,
    w: 100,
    h: 5,
    color: "#ff0000"
  });
}

function spawnChip() {
  chips.push({
    x: canvas.width,
    y: lanes[Math.floor(Math.random() * 3)] + 10,
    w: 20,
    h: 20,
    color: "#00ffff"
  });
}

function collide(a, b) {
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function drawBackground() {
  ctx.strokeStyle = "rgba(0,255,255,0.15)";
  for (let i = 0; i < canvas.height; i += 40) {
    ctx.beginPath();
    ctx.moveTo(0, i);
    ctx.lineTo(canvas.width, i);
    ctx.stroke();
  }

  ctx.strokeStyle = "rgba(255,0,255,0.3)";
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, 190);
  ctx.lineTo(canvas.width, 190);
  ctx.moveTo(0, 370);
  ctx.lineTo(canvas.width, 370);
  ctx.stroke();
}

function endGame() {
  ctx.fillStyle = "#ff0044";
  ctx.font = "50px Orbitron";
  ctx.fillText("ðŸ’€ GAME OVER ðŸ’€", 230, 200);
  gameOver = true;
  retryBtn.style.display = "block";  // mostra botÃ£o
}

// Reinicia o jogo ao clicar no botÃ£o
retryBtn.addEventListener("click", () => {
  init();
  loop();
});

// Loop do jogo
function loop() {
  if (gameOver) return;
  requestAnimationFrame(loop);
  frame++;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBackground();

  // Atualiza posiÃ§Ã£o do jogador
  player.y += (lanes[currentLane] - player.y) * 0.2;

  // Desenha jogador com sprite e transparÃªncia se invisÃ­vel
  if (player.sprite.complete) {
    ctx.globalAlpha = player.invisible ? 0.5 : 1;
    ctx.drawImage(player.sprite, player.x, player.y - 20, player.w, player.h);
    ctx.globalAlpha = 1;
  } else {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);
  }

  // Spawns
  if (frame % 80 === 0) spawnObstacle();
  if (frame % 150 === 0) spawnLaser();
  if (frame % 120 === 0) spawnChip();

  // ObstÃ¡culos
  for (let i = obstacles.length - 1; i >= 0; i--) {
    let o = obstacles[i];
    o.x -= speed;
    ctx.fillStyle = o.color;
    ctx.fillRect(o.x, o.y, o.w, o.h);

    if (o.x + o.w < 0) obstacles.splice(i, 1);
    else if (!player.invisible && !player.quantum && collide(player, o)) {
      endGame();
      return;
    }
  }

  // Lasers
  for (let i = lasers.length - 1; i >= 0; i--) {
    let l = lasers[i];
    l.x -= speed * 1.5;
    ctx.fillStyle = l.color;
    ctx.shadowBlur = 10;
    ctx.shadowColor = l.color;
    ctx.fillRect(l.x, l.y, l.w, l.h);
    ctx.shadowBlur = 0;

    if (l.x + l.w < 0) lasers.splice(i, 1);
    else if (!player.invisible && !player.quantum && collide(player, l)) {
      endGame();
      return;
    }
  }

  // Chips
  for (let i = chips.length - 1; i >= 0; i--) {
    let c = chips[i];
    c.x -= speed;
    ctx.fillStyle = c.color;
    ctx.beginPath();
    ctx.arc(c.x + 10, c.y + 10, 8, 0, Math.PI * 2);
    ctx.fill();

    if (c.x + c.w < 0) chips.splice(i, 1);
    else if (collide(player, c)) {
      score += 10;
      scoreEl.textContent = score;
      chips.splice(i, 1);
    }
  }

  // Aumenta dificuldade
  if (frame % 400 === 0) speed += 0.3;
}

// Inicializa o jogo e comeÃ§a o loop
init();
loop();
</script>
</body>
</html>
